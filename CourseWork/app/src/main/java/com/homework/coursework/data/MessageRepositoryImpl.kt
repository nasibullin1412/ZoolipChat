package com.homework.coursework.data

import com.homework.coursework.data.mappers.MessageDtoMapper
import com.homework.coursework.domain.entity.MessageData
import com.homework.coursework.domain.entity.StreamData
import com.homework.coursework.domain.entity.TopicData
import com.homework.coursework.domain.repository.MessageRepository
import com.homework.coursework.presentation.App
import com.homework.coursework.data.dto.Narrow
import com.homework.coursework.presentation.frameworks.network.utils.NetworkConstants.ANCHOR
import com.homework.coursework.presentation.frameworks.network.utils.NetworkConstants.NUM_AFTER
import com.homework.coursework.presentation.frameworks.network.utils.NetworkConstants.NUM_BEFORE
import io.reactivex.Observable
import kotlinx.serialization.ExperimentalSerializationApi


@ExperimentalSerializationApi
class MessageRepositoryImpl : MessageRepository {

    private val messageDtoMapper: MessageDtoMapper = MessageDtoMapper()

    override fun loadMessages(
        streamData: StreamData,
        topicData: TopicData
    ): Observable<List<MessageData>> {
        val narrow = Narrow.createNarrowForMessage(streamData, topicData)
        return App.instance.apiService.getMessages(
            anchor = ANCHOR,
            numAfter = NUM_AFTER,
            numBefore = NUM_BEFORE,
            narrow = narrow
        ).map(messageDtoMapper)
    }
}
/*
    @WorkerThread
    private fun generateMessagesList(idStream: Int, idTopic: Int): List<MessageData> {
        Log.d("Message Moc", Thread.currentThread().name)
        if (Random.nextInt() % 3 == 1) {
            throw IllegalArgumentException("Unexpected idStream")
        }
        return when (idStream) {
            0 -> {
                generalStream(idTopic)
            }
            1 -> {
                developStream(idTopic)
            }
            2 -> {
                designStream(idTopic)
            }
            else -> throw IllegalArgumentException("Unexpected idStream")
        }
    }


    private fun designStream(idTopic: Int): List<MessageData> {
        return when (idTopic) {
            0 -> {
                arrayListOf(
                    MessageData(
                        messageId = 0,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–ú–∞–º—É –ª—é–±–∏",
                        emojis = arrayListOf(
                            EmojiData(
                                emojiCode = "üòó",
                                emojiNumber = 1,
                                isCurrUserReacted = false
                            )
                        ),
                        date = "1 –§–µ–≤"
                    ),
                    MessageData(
                        messageId = 1,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–°—É–ø –ø–æ—Å–æ–ª–∏",
                        emojis = arrayListOf(),
                        date = "2 –§–µ–≤"
                    ),

                    MessageData(
                        messageId = 2,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–ö–æ–≤—ë—Ä –æ—Ç—Ç—Ä—è–Ω–∏",
                        emojis = arrayListOf(),
                        date = "2 –§–µ–≤"
                    ),

                    MessageData(
                        messageId = 3,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–ú—É—Ö–∞–º–µ–¥ –ê–ª–∏",
                        emojis = arrayListOf(),
                        date = "2 –§–µ–≤"
                    )
                )
            }
            1 -> {
                arrayListOf(
                    MessageData(
                        messageId = 0,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–ú–∞–º—É –ª—é–±–∏",
                        emojis = arrayListOf(
                            EmojiData(
                                emojiCode = "üòó",
                                emojiNumber = 1,
                                isCurrUserReacted = false
                            )
                        ),
                        date = "1 –§–µ–≤"
                    ),
                    MessageData(
                        messageId = 1,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–°—É–ø –ø–æ—Å–æ–ª–∏",
                        emojis = arrayListOf(),
                        date = "2 –§–µ–≤"
                    ),

                    MessageData(
                        messageId = 2,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–ö–æ–≤—ë—Ä –æ—Ç—Ç—Ä—è–Ω–∏",
                        emojis = arrayListOf(),
                        date = "2 –§–µ–≤"
                    ),

                    MessageData(
                        messageId = 3,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–ú—É—Ö–∞–º–µ–¥ –ê–ª–∏",
                        emojis = arrayListOf(),
                        date = "2 –§–µ–≤"
                    )
                )
            }
            2 -> {
                arrayListOf(
                    MessageData(
                        messageId = 0,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–ú–∞–º—É –ª—é–±–∏",
                        emojis = arrayListOf(
                            EmojiData(
                                emojiCode = "üòó",
                                emojiNumber = 1,
                                isCurrUserReacted = false
                            )
                        ),
                        date = "1 –§–µ–≤"
                    ),
                    MessageData(
                        messageId = 1,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–°—É–ø –ø–æ—Å–æ–ª–∏",
                        emojis = arrayListOf(),
                        date = "2 –§–µ–≤"
                    ),

                    MessageData(
                        messageId = 2,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–ö–æ–≤—ë—Ä –æ—Ç—Ç—Ä—è–Ω–∏",
                        emojis = arrayListOf(),
                        date = "2 –§–µ–≤"
                    ),

                    MessageData(
                        messageId = 3,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–ú—É—Ö–∞–º–µ–¥ –ê–ª–∏",
                        emojis = arrayListOf(),
                        date = "2 –§–µ–≤"
                    )
                )
            }

            else -> throw IllegalArgumentException("Unexpected idStream")
        }
    }

    private fun developStream(idTopic: Int): List<MessageData> {
        return when (idTopic) {
            0 -> {
                arrayListOf(
                    MessageData(
                        messageId = 0,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–ö–æ–ª–æ–±–æ–∫ –ø–æ–≤–µ—Å–∏–ª—Å—è",
                        emojis = arrayListOf(
                            EmojiData(
                                emojiCode = "üòó",
                                emojiNumber = 1,
                                isCurrUserReacted = false
                            )
                        ),
                        date = "1 –§–µ–≤"
                    ),
                    MessageData(
                        messageId = 1,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–ë—É—Ä–∞—Ç–∏–Ω–æ —É—Ç–æ–Ω—É–ª",
                        emojis = arrayListOf(),
                        date = "2 –§–µ–≤"
                    ),

                    MessageData(
                        messageId = 2,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–†—É—Å–∞–ª–∫–∞ —Å–µ–ª–∞ –Ω–∞ —à–ø–∞–≥–∞—Ç",
                        emojis = arrayListOf(),
                        date = "2 –§–µ–≤"
                    )
                )
            }
            1 -> {
                arrayListOf(
                    MessageData(
                        messageId = 0,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–ú–∞–º—É –ª—é–±–∏",
                        emojis = arrayListOf(
                            EmojiData(
                                emojiCode = "üòó",
                                emojiNumber = 1,
                                isCurrUserReacted = false
                            )
                        ),
                        date = "1 –§–µ–≤"
                    ),
                    MessageData(
                        messageId = 1,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–°—É–ø –ø–æ—Å–æ–ª–∏",
                        emojis = arrayListOf(),
                        date = "2 –§–µ–≤"
                    ),

                    MessageData(
                        messageId = 2,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–ö–æ–≤—ë—Ä –æ—Ç—Ç—Ä—è–Ω–∏",
                        emojis = arrayListOf(),
                        date = "2 –§–µ–≤"
                    ),

                    MessageData(
                        messageId = 3,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–ú—É—Ö–∞–º–µ–¥ –ê–ª–∏",
                        emojis = arrayListOf(),
                        date = "2 –§–µ–≤"
                    )
                )
            }
            else -> throw IllegalArgumentException("Unexpected idStream")
        }
    }

    private fun generalStream(idTopic: Int): List<MessageData> {
        return when (idTopic) {
            0 -> {
                arrayListOf(
                    MessageData(
                        messageId = 0,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–ú–∞–º—É –ª—é–±–∏",
                        emojis = arrayListOf(
                            EmojiData(
                                emojiCode = "üòó",
                                emojiNumber = 1,
                                isCurrUserReacted = false
                            )
                        ),
                        date = "1 –§–µ–≤"
                    ),
                    MessageData(
                        messageId = 1,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–°—É–ø –ø–æ—Å–æ–ª–∏",
                        emojis = arrayListOf(),
                        date = "2 –§–µ–≤"
                    ),

                    MessageData(
                        messageId = 2,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–ö–æ–≤—ë—Ä –æ—Ç—Ç—Ä—è–Ω–∏",
                        emojis = arrayListOf(),
                        date = "2 –§–µ–≤"
                    ),

                    MessageData(
                        messageId = 3,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–ú—É—Ö–∞–º–µ–¥ –ê–ª–∏",
                        emojis = arrayListOf(),
                        date = "2 –§–µ–≤"
                    )
                )
            }
            1 -> {
                arrayListOf(
                    MessageData(
                        messageId = 0,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–ú–∞–º—É –ª—é–±–∏",
                        emojis = arrayListOf(
                            EmojiData(
                                emojiCode = "üòó",
                                emojiNumber = 1,
                                isCurrUserReacted = false
                            )
                        ),
                        date = "1 –§–µ–≤"
                    ),
                    MessageData(
                        messageId = 1,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–°—É–ø –ø–æ—Å–æ–ª–∏",
                        emojis = arrayListOf(),
                        date = "2 –§–µ–≤"
                    ),

                    MessageData(
                        messageId = 2,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–ö–æ–≤—ë—Ä –æ—Ç—Ç—Ä—è–Ω–∏",
                        emojis = arrayListOf(),
                        date = "2 –§–µ–≤"
                    ),

                    MessageData(
                        messageId = 3,
                        userData = UserData(
                            0, "–ü–∞–≤–µ–ª –î—É—Ä–æ–≤",
                            "https://clck.ru/YEN9d"
                        ),
                        messageContent = "–ú—É—Ö–∞–º–µ–¥ –ê–ª–∏",
                        emojis = arrayListOf(),
                        date = "2 –§–µ–≤"
                    )
                )
            }
            else -> throw IllegalArgumentException("Unexpected idStream")
        }
    }
}*/
